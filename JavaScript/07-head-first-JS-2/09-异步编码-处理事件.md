---
typora-copy-images-to: img\09
---

# 异步编码：处理事件

## ★引子

在写popover组件的时候，我发现我对事件的认识，始终有点模糊！因此，我打算重新认识一下事件！

## ★前言

你以前编写的代码执行：**从上到下按顺序执行**，说白了就是按部就班的执行呗！

然而，JavaScript代码**通常不是这样编写的**，大多数JavaScript代码都是**事件响应式的**

那都有什么样的事件呢？——用户单击网页、通过网络收到数据、定时器到期、**DOM发生变化**等，事实上，在浏览器中，**幕后始终有各种事件在不断发生**

> 从同步到异步的转变，我没想到DOM发生变化也是一种事件，或许这是UI更新事件吧！

## ★学习目标

- 反思我们的编码方式
- 学习如何编写响应事件的代码以及为何要这样做

## ★收获

- **你的编程方式再不似从前**（**you aren’t in kansas anymore**）

## ★开始认识

### ◇动脑？

浏览器幕后会执行以下任务：

- 跟踪用户在网页上执行的所有单击操作，无论单击的是按钮、链接还是其他地方。
- 获取网页所需的额外数据。
- ……

如果浏览器可以在这些事件发生时发出通知，即通知你开发者去响应这些事件，那么你会写出怎样有趣的代码来呢？

### ◇事件是什么？

![1564645982281](img/09/1564645982281.png)

- 浏览器不会在获取并显示页面后就甩手不管了。在幕后，有很多事情在不断发生，如用户单击按钮等都会**触发事件**
- 每当有事件发生时，你都可以在代码中处理它，即提供**将在事件发生时调用的代码**。
- **你不必处理所有的事件，而只需处理自己关心的事件。**虽然有多事件都在发生，但我们可以选择无动于衷！反正，我只想处理我自己关心的时间，其它的事件的发生，我一概选择屏蔽，即我不会去响应这些事件！毕竟我可咩有那么多心力去管那么多事儿……

那么事件是什么呢？——浏览器幕后为你做的那些事儿，如同管家一样

有哪些事件呢？

**➹：**[事件参考 - MDN](https://developer.mozilla.org/zh-CN/docs/Web/Events)

事件对于我们编码而言就是，**每当有事件发生时，你都可以在代码中处理它**

### ◇事件处理程序是什么

> 它指的是事件处理程序

- 它是干吗的？——用来处理事件的，或者说是响应事件的！

- 它长啥样？——通常是一小段代码，知道事件发生时该如何做。

- 它是什么呢？——从代码的角度来看，它就是一个函数，当事件发生时，其处理程序函数将被调用

- 它还有其它名字？——回调函数、监听器

- 如何让它能在事件发生时得以调用？

  1. 注册它，而**注册它的方式有多种，具体采用哪种取决于事件的类型**

  2. 举个栗子——网页加载完毕后触发的事件：

     ![1564653581581](img/09/1564653581581.png)

### ◇如何创建第一个事件处理程序

> <mark>要理解事件，最佳方式是编写一个处理程序，并将其关联到一个事件</mark>

如何为网页加载事件添加个callback呢？

> 前提条件：你得知道网页加载事件的触发时间点是：浏览器加载完网页、显示网页的所有内容并生成了表示网页的DOM。（其实DOM构建结束、然后内容都加载完毕后触发！）

1. 编写一个处理网页加载事件的函数，功能是在网页加载完毕时`alert`一下，对了，你还得取个醒目的名字 ，如`pageLoadedHandler`

   ![1564654756293](img/09/1564654756293.png)

2. 处理程序编写好后，需要**建立关联，让浏览器知道有这么一个函数，应在加载事件发生时调用它**。

   ![1564655214829](img/09/1564655214829.png)

   我觉得这种姿势建立关联是很不好的！因为这样改变了全局属性的值，不过我查看了`onload`的初始值，发现它是 `null`值，这给了我一个启示是事件总是会发生的，如果你给了 `onload`一个callback，那么它就是有值的，而这个值就会让你看到，`onload`事件时有触发的，并且我们给它的callback是有执行的。

3. 编写这些代码后，我们就知道**网页加载完毕后**，浏览器将调用**赋给属性`window.onload`**的函数。

### ◇测试事件处理程序

![1564655700938](img/09/1564655700938.png)

> 注意：是响应回来的一点内容，浏览器就会解析一点内容！如果遇到图片、css、js文件，那么就会去请求它们，等这些资源下载并加载完毕后，才会去执行关联load事件的callback！

### ◇考考你的脑力？

**在不编写函数的情况下，能否指定事件处理程序？**

> 函数就是事件处理程序呀？你不编写函数，哪里的callback啊？

- 编写代码的方式
  - 代码执行是线性的（linear）

- 以响应事件的方式组织代码是另一种代码编写方式。

  - 怎么做？
    - 考虑可能发生的事件
    - 代码应如何响应这些事件
  - 在计算机科学中，通常说这种代码（callback）是异步（asynchronous）的，因为我们**编写的代码仅在相应的事件发生时才会被调用**。

  - 这种编码方式也**改变了我们看待问题的角度**，**不再逐步地编写代码来实现算法**，而是将处理各种事件的众多处理程序整合起来，构成一个**应用**程序。

- 那我以MVC的方式组织代码，而这是不是另外一种代码编写方式呢？这种方式可是可以蕴含同步代码和异步代码的！

## ★通过创建一个游戏来理解事件

> 理解事件的最佳方式是实践，因此我们用事件来规划游戏。











---

## ★总结

- handler是处理程序之意，或者说是处理器！常用作事件处理程序的名字后缀！
- 如果你想成为真正的JavaScript开发人员，那么就必须学习如何处理事件。
- JavaScript代码，有的是同步的代码，有的是异步的代码，但大多是异步的代码！这里的异步代码，指的是callback，因为它是异步调用执行的！

## ★Q&A

### ①事件？

在这里事件指的是事件驱动程序设计（一种计算机程序设计模型）。

> 在计算机编程中，事件驱动编程是一种编程范式，其中程序的流程由用户动作(鼠标点击、按键)、传感器输出或来自其他程序或线程的消息等事件决定。事件驱动编程是图形用户界面和其他应用程序(例如，JavaScript Web应用程序)中使用的主要范例，这些应用程序**以响应用户输入而执行某些动作为中心**。

总之，程序的运行流程是由用户决定的！而不是我们程序员决定的！

**➹：**[事件驱动程序设计 - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/%E4%BA%8B%E4%BB%B6%E9%A9%85%E5%8B%95%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88)

### ②onload、DOMContentLoaded？

HTML页面的生命周期有以下三个重要事件：

- `DOMContentLoaded` —— 浏览器已经完全加载了 HTML，DOM 树已经构建完毕，但是像是 `<img>` 和样式表等外部资源可能并没有下载完毕。
- `load` —— 浏览器已经加载了所有的资源（图像，样式表等）。
- `beforeunload/unload` —— 当用户离开页面的时候触发。

每个事件都有特定的用途

- `DOMContentLoaded` —— DOM 加载完毕，所以 JS 可以访问所有 DOM 节点，初始化界面。
- `load` —— 附加资源已经加载完毕，可以在此事件触发时获得图像的大小（如果没有被在 HTML/CSS 中指定）
- `beforeunload/unload` —— 用户正在离开页面：可以询问用户是否保存了更改以及是否确定要离开页面。

**➹：**[[译]页面生命周期：DOMContentLoaded, load, beforeunload, unload解析 · Issue #3 · fi3ework/blog](https://github.com/fi3ework/blog/issues/3)

### ③有哪些代码编写方式？

我所了解到的：

- 同步代码
- 异步代码

**➹：**[源代码怎么编写的？ - 知乎](https://www.zhihu.com/question/57885973)

**➹：**[编写傻瓜式的代码 – 腊八粥 – 一个关于计算机、极客、阅读和写作的英文文章的翻译网站](http://labazhou.net/2015/10/write-stupid-code/)

**➹：**[函数式编程的代码怎么组织？ - 知乎](https://www.zhihu.com/question/20098885)

**➹：**[编程中，有哪些好的习惯从一开始就值得坚持？ - 知乎](https://www.zhihu.com/question/32255673/answer/517173833)

**➹：**[编程的几个思想 - 知乎](https://zhuanlan.zhihu.com/p/25288280)

**➹：**[组织代码的四大策略](https://www.infoq.cn/article/four-strategies-for-organizing-code)

**➹：**[你是如何去组织项目中的 Less/Sass 代码的？ - 知乎](https://www.zhihu.com/question/35708352)

**➹：**[如何写好一个类？ - 知乎](https://www.zhihu.com/question/42115070)

**➹：**[如何写好一个parser？ - 知乎](https://www.zhihu.com/question/66174185)

**➹：**[如何写出优美的 JavaScript 代码？ - 知乎](https://www.zhihu.com/question/20635785)

**➹：**[如何写出高水平的前端代码？ - 知乎](https://www.zhihu.com/question/318532256)

**➹：**[作为前端工程师，你认为写过的或你看到过的最好的前端代码是什么？ - 知乎](https://www.zhihu.com/question/29254108)

**➹：**[如何写出优秀的代码注释？ - 知乎](https://www.zhihu.com/question/21880307)

### ④如何编写函数？

**➹：**[提高代码质量：如何编写函数 - 狼狼的蓝胖子](http://luopq.com/2016/02/21/write-good-function/)

